<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Emond by ondrej1024</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Emond</h1>
        <p>Smart energy monitor device software for EmonCMS</p>
        <p class="view"><a href="https://github.com/ondrej1024/emond">View the Project on GitHub <small>ondrej1024/emond</small></a></p>
        <ul>
          <li><a href="https://github.com/ondrej1024/emond/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/ondrej1024/emond/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/ondrej1024/emond">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="emond" class="anchor" href="#emond" aria-hidden="true"><span class="octicon octicon-link"></span></a>emond</h1>

<h4>
<a id="smart-energy-monitor" class="anchor" href="#smart-energy-monitor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Smart Energy Monitor</h4>

<h3>
<a id="about" class="anchor" href="#about" aria-hidden="true"><span class="octicon octicon-link"></span></a>About</h3>

<p>This software implements a Smart Energy Monitor to be run on the RaspberryPi. In short, it is a simplified version of a combination of the <em>emonTX</em>, <em>emonGLCD</em> and <em>emonBase</em> modules, developed by the OpenEnergyMonitor project (<a href="http://openenergymonitor.org">http://openenergymonitor.org</a>). It is a pure software solution and doesn't require any additional hardware modules to be added.<br>
It connects to an energy meter via the SO (pulse) interface and measures/calculates the instant power consumption as well as the electrical energy on daily and monthly basis. The data is sent to EmonCMS (<a href="http://emoncms.org">http://emoncms.org</a>) which is the Web server used by the OpenEnergyMonitor project. EmonCMS can then be deployed to further process your data (store, manipulate, chart, ...).<br>
The easiest way to display the energy data is to use the "My Electrics" appliance in EmonCMS.<br>
A local LCD display is supported to have instant access to the latest measurements.<br>
<br></p>

<h3>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h3>

<ul>
<li>Instant power measurement using energy meter pulses</li>
<li>Daily and monthly energy calculation</li>
<li>Periodic saving of energy counters to persistant storage and restoring at restart</li>
<li>Filtering of short glitches and false pulses on the pulse counting GPIO line</li>
<li>Display of measurements on local LCD display (via integrated lcdproc client)</li>
<li>Transmission of measurements to EmonCMS (via WebAPI)</li>
<li>Full compatibility with "My Electric" appliance in EmonCMS</li>
<li>Easy customization of parameters via configuration file<br>
<br>
</li>
</ul>

<h3>
<a id="coming-soon-to-do" class="anchor" href="#coming-soon-to-do" aria-hidden="true"><span class="octicon octicon-link"></span></a>Coming soon (to do)</h3>

<ul>
<li>Configurable WebAPI update rate limit</li>
<li>Support for 1-wire temperatue sensor<br>
<br>
</li>
</ul>

<h3>
<a id="nice-to-have-wishlist" class="anchor" href="#nice-to-have-wishlist" aria-hidden="true"><span class="octicon octicon-link"></span></a>Nice to have (wishlist)</h3>

<ul>
<li>Display daily/monthly energy cost</li>
<li>Command line tool for reading current power values and energy counters</li>
<li>Alarm generation when approaching maximum power consumption</li>
<li>Support for Energy meters with Modbus interface
<br>
</li>
</ul>

<h3>
<a id="hardware-modules" class="anchor" href="#hardware-modules" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hardware modules</h3>

<h4>
<a id="raspberry-pi" class="anchor" href="#raspberry-pi" aria-hidden="true"><span class="octicon octicon-link"></span></a>Raspberry Pi</h4>

<p>As base module a Raspberry Pi is used to run the software. This dependency is derived from the use of the wiringPi library which greatly simplifies the GPIO handling. However, if the GPIO programming is ported to a standard framework like Linux GPIO sysfs, then <strong>emond</strong> should be able to run also on other embedded Linux boards.  </p>

<h4>
<a id="energy-meter" class="anchor" href="#energy-meter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Energy meter</h4>

<p>Since <strong>emond</strong> uses the pulse counting method to calculate the instant power and electrical energy, an energy meter with a pulse output has to be used. There are basically two methods:  </p>

<ul>
<li>optical pulse counting (via energy meters LED)</li>
<li>electrical puylse counting (via energy meters SO interface)</li>
</ul>

<p>For more info on pulse counting see <a href="http://openenergymonitor.org/emon/buildingblocks/introduction-to-pulse-counting">http://openenergymonitor.org/emon/buildingblocks/introduction-to-pulse-counting</a>.  </p>

<p><strong>emond</strong> is being developed and tested with this type of energy meter that was installed in addition to the one provided by the energy company:  </p>

<p><img src="http://www.digitale-elektronik.de/shopsystem/images/WSZ230V-50A_large.jpg" alt="Energy Meter"></p>

<p>The cabling has to be done as follows:</p>

<ul>
<li>SO- output on energy meter to GND on RaspberryPi</li>
<li>SO+ output on energy meter to GPIO[x] on RaspberryPi<br>
<br>
</li>
</ul>

<h4>
<a id="lcd-display" class="anchor" href="#lcd-display" aria-hidden="true"><span class="octicon octicon-link"></span></a>LCD display</h4>

<p>The LCD display is optional. It is controlled via the <em>lcdproc</em> software. <strong>emond</strong> implements an lcdproc client which sends its data to lcdproc which eventually displays the data on the LCD. Therefore any display supported by lcdproc can be used. However <strong>emond</strong> is optimised for a 20x4 character display such this one:</p>

<p><img src="http://store.melabs.com/graphics/00000001/CFAH2004AYYHJT.jpg" alt="LCD display"></p>

<p>On the RaspberryPi, lcdproc supports this kind of display connected via the GPIO lines.<br>
<br></p>

<h3>
<a id="screenshot" class="anchor" href="#screenshot" aria-hidden="true"><span class="octicon octicon-link"></span></a>Screenshot</h3>

<p>This is a screenshot of the EmonCMS dashboard, showing a daily power consumption chart and the current power in a gauge.  </p>

<p><img src="https://raw.githubusercontent.com/ondrej1024/emond/bf3293137d0f1bc4acef06d7218ffeec1ce595ba/image/dashboard.png" alt="Screenshot"></p>

<h3>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h3>

<p>If you don't have a cross compile environment for the RaspberryPi installed on your PC, it is easiest to build the software directly on the RaspberryPi. Follow theses simple steps from the RPi console. Make sure you have the necessary packages installed (e.g. git).  </p>

<ul>
<li><p>Install the wiringPi library :<br>
Follow the instructions on the projects home page: <a href="http://wiringpi.com/download-and-install">http://wiringpi.com/download-and-install</a>  </p></li>
<li>
<p>Install CURL library :  </p>

<pre>
sudo apt-get install libcurl4-gnutls-dev
</pre>
</li>
<li>
<p>Clone git repository :  </p>

<pre>
git clone https://github.com/ondrej1024/emond
cd emond
</pre>
</li>
<li>
<p>Alternatively get latest source code version :  </p>

<pre>
wget https://github.com/ondrej1024/emond/archive/master.zip
unzip master.zip
cd emond-master
</pre>
</li>
<li>
<p>Build and install :  </p>

<pre>
make
sudo make install
</pre>
</li>
<li>
<p>Install lcdproc :<br>
<strong>emond</strong> needs the LCDd server from the lcdproc project (<a href="http://www.lcdproc.org">http://www.lcdproc.org</a>) to be installed and running on your system if you want to display the measurements on a local LCD diplay. However, emond can also be used without local display.  </p>

<pre>
sudo apt-get install lcdproc
</pre>

<p>Then you need to configure the lcdproc server LCDd according to your display via its configuration file LCDd.conf<br>
<br></p>
</li>
</ul>

<h3>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h3>

<p>You can customize the application to your needs via the config file emon.conf which should be placed in the /etc/ system folder. An example file is provided together with the programs source code.  </p>

<pre>
# Pulse counter specific parameters
################################################
[counter]
pulse_input_pin = 25    # BCM pin number used for pulse input from energy meter
wh_per_pulse    = 100   # Wh per pulse (Energy meter setting)
pulse_length    = 100   # pulse length (in ms), leave blank for auto detection
max_power       = 3300  # max possible power (in W) provided by energy company

# Storage parameters
################################################
[storage]
flash_dir = /media/data # Folder for permanent (writable) storage

# LCD display specific parameters
################################################
[lcd]
lcdproc_port =  # Specify this if not using default lcdproc port
 
# WebAPI specific parameters
################################################
[webapi]
api_key     = 1234567890  # Personal EmonCMS Write API key 
node_number = 1           # Identifier of your node in EmonCMS
</pre>

<p><br></p>

<h3>
<a id="run-the-program" class="anchor" href="#run-the-program" aria-hidden="true"><span class="octicon octicon-link"></span></a>Run the program</h3>

<p>During the installation process, an init script is automatically installed in /etc/init.d/ Therefore the emond program can be started via the following command:</p>

<pre>
    sudo service emon start
</pre>

<p>If you want to autostart the program at every system reboot (recommended), issue the following command:</p>

<pre>
    sudo update-rc.d emon defaults
</pre>

<h3>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h3>

<p>Any contribution like feedback, bug reports or code proposals are welcome and highly encouraged.<br>
Get in touch by e-mail to ondrej.wisniewski (at) gmail.com  </p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/ondrej1024">ondrej1024</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-55164186-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>